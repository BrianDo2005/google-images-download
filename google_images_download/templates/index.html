{% extends "bootstrap/base.html" %}

{% block title %} Google image download server {% endblock %}

{% block styles %}
  {{super()}}
  <!--<link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">-->
  <link rel="icon" href="data:;base64,iVBORw0KGgo=">
{% endblock %}

{% block content %}
  <div class="container">
    {% with messages = get_flashed_messages() %}
      {% if messages %}
       <ul class=flashes>
       {% for message in messages %}
         <li>{{ message }}</li>
       {% endfor %}
       </ul>
      {% endif %}
    {% endwith %}
    <p>Welcome to Google Image Download Server </p>
    <form method="POST" action="{{ url_for('index') }}">
      {{ form.csrf_token }}
      {{ form.query.label }} {{ form.query(size=20) }}
      <br><br>
      {{ form.starting }}
      {{ form.ending }}
      <input type="submit" value="Go">
    </form>
    {% if query %}
    <p> query [{{query}}] found {{result['match']|length}} match(s) </p>
    {% endif %}
    {% if debug_info %}
      <ul>
      {% for key, value in debug_info.items() %}
        {% if key == 'url' %}
        <li>{{key}}: <a href="{{value}}">{{ value.split('://')[1] }}</a></li>
        {% elif key == 'dump_html' %}
        <li>{{key}}: <a href="file://{{value[0]}}">{{ value[1] }}</a></li>
        {% else %}
        <!--{{key}}: {{value}}-->
        {% endif %}
      {% else %}
        <!--Empty debug info-->
      {% endfor %}
      </ul>
    {% endif %}

    {% if result %}
    <h5>Match result</h5>
    <div>
    {% for entry in result['match'] %}
        <div class="media col-md-6 text-center">
          <div class="media-left">
            <figure>
              <img style="max-width:256px" src='{{entry['json_data'][0]['tu']}}'>
      	<figcaption>
      	  {{entry['json_data'][0]['ow']}}x{{entry['json_data'][0]['oh']}}
      	  <br/>
      	  <span data-placement="left" data-toggle="tooltip" title="{{entry['json_data'][0]['isu']}}">{{entry['json_data'][0]['isu']|truncate(20)}}</span>
      	</figcaption>
            </figure>
            </div>
          <div class="media-body text-left">
            <h4 class="media-heading"> {{entry['json_data'][0]['pt']}}</h4>
	    <span>
	      {{entry['json_data'][0]['s']}}<br/>
	      link:
	      <a class="label label-default" href="{{entry['json_data'][0]['ru']}}">page</a>
	      <a class="label label-default" href="{{entry['json_data'][0]['ou']}}">image</a>
	      <a class="label label-default" href="https://www.google.com/searchbyimage?image_url={{entry['json_data'][0]['ou']|urlencode}}&safe=off">google</a>
          </div>
          {% for key, value in entry['json_data'][0].items()|sort %}
            <!--{{key}}: {{value}}-->
          {% endfor %}
        </div>
    {% endfor %}
    </div>
    {% endif %}
  </div>

{% endblock %}
